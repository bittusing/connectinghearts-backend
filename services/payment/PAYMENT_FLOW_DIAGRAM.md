# Razorpay Payment Flow - Block Diagrams

## ğŸ“Š Complete Payment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PAYMENT SYSTEM ARCHITECTURE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WEB APP    â”‚         â”‚  MOBILE APP  â”‚         â”‚  ADMIN PANEL  â”‚
â”‚  (Frontend)  â”‚         â”‚ (React Nativeâ”‚         â”‚   (Optional) â”‚
â”‚              â”‚         â”‚   /Flutter)  â”‚         â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚                        â”‚
       â”‚                      â”‚                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   BACKEND API    â”‚
                    â”‚  (Express.js)    â”‚
                    â”‚                  â”‚
                    â”‚  Controllers:    â”‚
                    â”‚  - buyMembership â”‚
                    â”‚  - verifyPayment â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PAYMENT SERVICE â”‚
                    â”‚   (Abstraction)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ RAZORPAY GATEWAY â”‚
                    â”‚   (Implementation)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  RAZORPAY API    â”‚
                    â”‚  (External)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ WEB INTEGRATION FLOW (Step by Step)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WEB PAYMENT FLOW - DETAILED STEPS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: USER SELECTS MEMBERSHIP PLAN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  Clicks     â”‚
â”‚  "Buy Plan" â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR WEB FRONTEND CODE (What You Need to Implement)                â”‚
â”‚                                                                      â”‚
â”‚  1. User clicks membership purchase button                          â”‚
â”‚  2. Get membership ID from UI                                       â”‚
â”‚  3. Get user authentication token (JWT)                             â”‚
â”‚  4. Call backend API to create order                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ JavaScript/React Code:
       â”‚ const response = await fetch(
       â”‚   `/api/dashboard/buyMembership/${membershipId}`,
       â”‚   { headers: { 'Authorization': `Bearer ${token}` } }
       â”‚ );
       â”‚ const orderData = await response.json();
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: buyMembership Controller                                  â”‚
â”‚  - Validates membership plan                                        â”‚
â”‚  - Validates user authentication                                    â”‚
â”‚  - Calls Payment Service                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PAYMENT SERVICE â†’ RAZORPAY GATEWAY                                 â”‚
â”‚  - Creates Razorpay order                                           â”‚
â”‚  - Returns: orderId, keyId, amount, currency                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Response:
       â”‚ {
       â”‚   "orderId": "order_xxx",
       â”‚   "keyId": "rzp_test_xxx",
       â”‚   "amount": 10000,
       â”‚   "currency": "INR"
       â”‚ }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR WEB FRONTEND CODE (What You Need to Implement)                â”‚
â”‚                                                                      â”‚
â”‚  STEP 2: Initialize Razorpay Checkout                               â”‚
â”‚                                                                      â”‚
â”‚  Include Razorpay script in HTML:                                    â”‚
â”‚  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>â”‚
â”‚                                                                      â”‚
â”‚  JavaScript Code:                                                    â”‚
â”‚  const options = {                                                   â”‚
â”‚    key: orderData.keyId,        // From backend                      â”‚
â”‚    amount: orderData.amount,    // From backend                      â”‚
â”‚    currency: orderData.currency,// From backend                     â”‚
â”‚    name: "Connecting Hearts",                                        â”‚
â”‚    order_id: orderData.orderId, // From backend                      â”‚
â”‚    handler: function(response) {                                      â”‚
â”‚      // Payment successful - go to STEP 3                            â”‚
â”‚    }                                                                 â”‚
â”‚  };                                                                  â”‚
â”‚  const razorpay = new Razorpay(options);                            â”‚
â”‚  razorpay.open();  // Opens Razorpay payment popup                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAZORPAY CHECKOUT POPUP (Handled by Razorpay)                     â”‚
â”‚  - User enters card details                                          â”‚
â”‚  - User completes payment                                            â”‚
â”‚  - Razorpay processes payment                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Payment Success Response:
       â”‚ {
       â”‚   razorpay_payment_id: "pay_xxx",
       â”‚   razorpay_order_id: "order_xxx",
       â”‚   razorpay_signature: "sig_xxx"
       â”‚ }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR WEB FRONTEND CODE (What You Need to Implement)                â”‚
â”‚                                                                      â”‚
â”‚  STEP 3: Verify Payment with Backend                                â”‚
â”‚                                                                      â”‚
â”‚  In the handler function:                                            â”‚
â”‚  const verifyResponse = await fetch(                                 â”‚
â”‚    `/api/dashboard/verifyPayment/${response.razorpay_order_id}`,     â”‚
â”‚    { headers: { 'Authorization': `Bearer ${token}` } }               â”‚
â”‚  );                                                                  â”‚
â”‚  const result = await verifyResponse.json();                         â”‚
â”‚                                                                      â”‚
â”‚  if (result.status === 'success') {                                  â”‚
â”‚    // Show success message                                           â”‚
â”‚    // Update UI - membership activated                               â”‚
â”‚    // Redirect or refresh page                                       â”‚
â”‚  }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND: verifyPayment Controller                                  â”‚
â”‚  - Calls Payment Service to verify with Razorpay                    â”‚
â”‚  - Checks payment status                                            â”‚
â”‚  - If PAID: Activates membership                                     â”‚
â”‚  - Saves payment audit record                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PAYMENT SERVICE â†’ RAZORPAY GATEWAY                                 â”‚
â”‚  - Fetches order details from Razorpay                              â”‚
â”‚  - Verifies payment status                                           â”‚
â”‚  - Returns normalized response                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUCCESS   â”‚
â”‚ Membership  â”‚
â”‚  Activated  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± MOBILE APP INTEGRATION FLOW

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 MOBILE APP PAYMENT FLOW - DETAILED STEPS                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: USER SELECTS MEMBERSHIP PLAN
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚  Taps       â”‚
â”‚  "Buy Plan" â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR MOBILE APP CODE (React Native/Flutter)                        â”‚
â”‚                                                                      â”‚
â”‚  STEP 1: Create Order via Backend API                               â”‚
â”‚                                                                      â”‚
â”‚  const response = await fetch(                                       â”‚
â”‚    `${API_URL}/api/dashboard/buyMembership/${membershipId}`,         â”‚
â”‚    {                                                                 â”‚
â”‚      headers: {                                                     â”‚
â”‚        'Authorization': `Bearer ${userToken}`,                      â”‚
â”‚        'Content-Type': 'application/json'                           â”‚
â”‚      }                                                               â”‚
â”‚    }                                                                 â”‚
â”‚  );                                                                  â”‚
â”‚  const orderData = await response.json();                           â”‚
â”‚                                                                      â”‚
â”‚  // orderData contains:                                             â”‚
â”‚  // - orderId: "order_xxx"                                          â”‚
â”‚  // - keyId: "rzp_test_xxx"                                         â”‚
â”‚  // - amount: 10000                                                 â”‚
â”‚  // - currency: "INR"                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR MOBILE APP CODE (React Native)                                â”‚
â”‚                                                                      â”‚
â”‚  STEP 2: Install Razorpay SDK                                       â”‚
â”‚  npm install react-native-razorpay                                   â”‚
â”‚  cd ios && pod install  (for iOS)                                   â”‚
â”‚                                                                      â”‚
â”‚  STEP 3: Open Razorpay Checkout                                     â”‚
â”‚                                                                      â”‚
â”‚  import RazorpayCheckout from 'react-native-razorpay';              â”‚
â”‚                                                                      â”‚
â”‚  const options = {                                                   â”‚
â”‚    description: 'Membership Purchase',                               â”‚
â”‚    image: 'https://your-logo-url.com/logo.png',                      â”‚
â”‚    currency: orderData.currency,                                     â”‚
â”‚    key: orderData.keyId,          // From backend                    â”‚
â”‚    amount: orderData.amount.toString(), // Must be string            â”‚
â”‚    name: 'Connecting Hearts',                                        â”‚
â”‚    order_id: orderData.orderId,   // From backend                   â”‚
â”‚    prefill: {                                                        â”‚
â”‚      email: userEmail,                                               â”‚
â”‚      contact: userPhone,                                             â”‚
â”‚      name: userName                                                  â”‚
â”‚    },                                                                â”‚
â”‚    theme: { color: '#3399cc' }                                      â”‚
â”‚  };                                                                  â”‚
â”‚                                                                      â”‚
â”‚  try {                                                               â”‚
â”‚    const razorpayResponse = await RazorpayCheckout.open(options);   â”‚
â”‚    // Payment successful - go to STEP 4                              â”‚
â”‚  } catch (error) {                                                   â”‚
â”‚    // Payment failed or cancelled                                    â”‚
â”‚  }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAZORPAY NATIVE SDK (Handled by Razorpay)                         â”‚
â”‚  - Opens native payment screen                                       â”‚
â”‚  - User enters payment details                                       â”‚
â”‚  - User completes payment                                           â”‚
â”‚  - Returns payment response                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Payment Success Response:
       â”‚ {
       â”‚   razorpay_payment_id: "pay_xxx",
       â”‚   razorpay_order_id: "order_xxx",
       â”‚   razorpay_signature: "sig_xxx"
       â”‚ }
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR MOBILE APP CODE (React Native)                                â”‚
â”‚                                                                      â”‚
â”‚  STEP 4: Verify Payment with Backend                                â”‚
â”‚                                                                      â”‚
â”‚  const verifyResponse = await fetch(                                 â”‚
â”‚    `${API_URL}/api/dashboard/verifyPayment/${razorpayResponse.razorpay_order_id}`,â”‚
â”‚    {                                                                 â”‚
â”‚      headers: {                                                     â”‚
â”‚        'Authorization': `Bearer ${userToken}`,                       â”‚
â”‚        'Content-Type': 'application/json'                           â”‚
â”‚      }                                                               â”‚
â”‚    }                                                                 â”‚
â”‚  );                                                                  â”‚
â”‚                                                                      â”‚
â”‚  const result = await verifyResponse.json();                        â”‚
â”‚                                                                      â”‚
â”‚  if (result.status === 'success') {                                 â”‚
â”‚    Alert.alert('Success', 'Membership activated!');                â”‚
â”‚    // Update UI - refresh membership status                          â”‚
â”‚    // Navigate to success screen                                    â”‚
â”‚  } else {                                                            â”‚
â”‚    Alert.alert('Error', result.err);                               â”‚
â”‚  }                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   SUCCESS   â”‚
â”‚ Membership  â”‚
â”‚  Activated  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ BACKEND FLOW (Internal Process)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND INTERNAL FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REQUEST: GET /api/dashboard/buyMembership/:id
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dashboard.controller.js - buyMembership()                          â”‚
â”‚                                                                      â”‚
â”‚  1. Extract membership ID from params                               â”‚
â”‚  2. Get user ID from JWT token (req.userId)                         â”‚
â”‚  3. Fetch membership data from database                             â”‚
â”‚  4. Fetch user data from database                                   â”‚
â”‚  5. Validate membership and user                                    â”‚
â”‚  6. Prepare order data:                                             â”‚
â”‚     {                                                                â”‚
â”‚       amount: membershipData.membershipAmount,                      â”‚
â”‚       currency: membershipData.currency,                            â”‚
â”‚       orderId: timestamp,                                           â”‚
â”‚       customer: { id, name, email, phone },                         â”‚
â”‚       metadata: { membership_id }                                   â”‚
â”‚     }                                                                â”‚
â”‚  7. Call paymentService.createOrder(orderData)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  paymentService.js - createOrder()                                  â”‚
â”‚                                                                      â”‚
â”‚  1. Get current gateway (RazorpayGateway)                           â”‚
â”‚  2. Call gateway.createOrder(orderData)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  razorpayGateway.js - createOrder()                                 â”‚
â”‚                                                                      â”‚
â”‚  1. Convert amount to paise (amount * 100)                          â”‚
â”‚  2. Prepare Razorpay order payload:                                 â”‚
â”‚     {                                                                â”‚
â”‚       amount: 10000,        // in paise                              â”‚
â”‚       currency: "INR",                                               â”‚
â”‚       receipt: "order_123",                                          â”‚
â”‚       notes: { membership_id: "..." }                               â”‚
â”‚     }                                                                â”‚
â”‚  3. Call razorpay.orders.create(payload)                          â”‚
â”‚  4. Normalize response:                                             â”‚
â”‚     {                                                                â”‚
â”‚       orderId: razorpayOrder.id,                                    â”‚
â”‚       keyId: process.env.RAZORPAY_KEY_ID,                           â”‚
â”‚       amount: razorpayOrder.amount,                                 â”‚
â”‚       currency: razorpayOrder.currency                               â”‚
â”‚     }                                                                â”‚
â”‚  5. Return normalized response                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Response flows back to controller
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dashboard.controller.js - buyMembership()                          â”‚
â”‚                                                                      â”‚
â”‚  8. Return response to frontend                                     â”‚
â”‚     {                                                                â”‚
â”‚       orderId, keyId, amount, currency, etc.                        â”‚
â”‚     }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


REQUEST: GET /api/dashboard/verifyPayment/:orderID
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dashboard.controller.js - verifyPayment()                          â”‚
â”‚                                                                      â”‚
â”‚  1. Extract order ID from params                                    â”‚
â”‚  2. Get user ID from JWT token                                       â”‚
â”‚  3. Validate order ID and user                                      â”‚
â”‚  4. Call paymentService.verifyPayment(orderID)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  paymentService.js - verifyPayment()                                â”‚
â”‚                                                                      â”‚
â”‚  1. Get current gateway (RazorpayGateway)                           â”‚
â”‚  2. Call gateway.verifyPayment(orderID)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  razorpayGateway.js - verifyPayment()                              â”‚
â”‚                                                                      â”‚
â”‚  1. Call razorpay.orders.fetch(orderID)                             â”‚
â”‚  2. Call razorpay.orders.fetchPayments(orderID)                      â”‚
â”‚  3. Normalize response:                                             â”‚
â”‚     {                                                                â”‚
â”‚       orderStatus: "PAID" (normalized),                             â”‚
â”‚       orderAmount: amount / 100,                                    â”‚
â”‚       paymentDetails: { ... },                                      â”‚
â”‚       notes: { membership_id: "..." }                               â”‚
â”‚     }                                                                â”‚
â”‚  4. Return normalized response                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Response flows back to controller
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  dashboard.controller.js - verifyPayment()                          â”‚
â”‚                                                                      â”‚
â”‚  5. Check if orderStatus === "PAID"                                 â”‚
â”‚  6. If PAID:                                                         â”‚
â”‚     - Get membership_id from notes                                   â”‚
â”‚     - Fetch membership plan                                          â”‚
â”‚     - Update user membership:                                        â”‚
â”‚       * membershipStartDate = now                                    â”‚
â”‚       * memberShipExpiryDate = now + duration                        â”‚
â”‚       * planName = membership.planName                               â”‚
â”‚       * heartCoins += membership.heartCoins                         â”‚
â”‚     - Save payment audit record                                     â”‚
â”‚  7. Return success/error response                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ WHAT YOU NEED TO DO IN WEB FRONTEND

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WEB FRONTEND IMPLEMENTATION CHECKLIST                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 1: Include Razorpay Script
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Add to your HTML <head> or before closing </body>:               â”‚
   â”‚                                                                 â”‚
   â”‚ <script src="https://checkout.razorpay.com/v1/checkout.js">    â”‚
   â”‚ </script>                                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 2: Create Order Function
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ async function createPaymentOrder(membershipId, userToken) {     â”‚
   â”‚   try {                                                          â”‚
   â”‚     const response = await fetch(                                â”‚
   â”‚       `/api/dashboard/buyMembership/${membershipId}`,           â”‚
   â”‚       {                                                          â”‚
   â”‚         headers: {                                               â”‚
   â”‚           'Authorization': `Bearer ${userToken}`,                â”‚
   â”‚           'Content-Type': 'application/json'                    â”‚
   â”‚         }                                                        â”‚
   â”‚       }                                                          â”‚
   â”‚     );                                                           â”‚
   â”‚                                                                  â”‚
   â”‚     if (!response.ok) {                                         â”‚
   â”‚       throw new Error('Failed to create order');                â”‚
   â”‚     }                                                            â”‚
   â”‚                                                                  â”‚
   â”‚     const orderData = await response.json();                    â”‚
   â”‚     return orderData;  // Contains: orderId, keyId, amount, etc.â”‚
   â”‚   } catch (error) {                                             â”‚
   â”‚     console.error('Order creation error:', error);             â”‚
   â”‚     throw error;                                                â”‚
   â”‚   }                                                              â”‚
   â”‚ }                                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 3: Open Razorpay Checkout Function
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ function openRazorpayCheckout(orderData, userData) {            â”‚
   â”‚   const options = {                                              â”‚
   â”‚     key: orderData.keyId,        // From backend                â”‚
   â”‚     amount: orderData.amount,     // In paise (already from API) â”‚
   â”‚     currency: orderData.currency,                               â”‚
   â”‚     name: "Connecting Hearts",                                   â”‚
   â”‚     description: "Membership Purchase",                         â”‚
   â”‚     order_id: orderData.orderId, // Razorpay order ID          â”‚
   â”‚     handler: async function(response) {                          â”‚
   â”‚       // This runs when payment is successful                   â”‚
   â”‚       console.log('Payment ID:', response.razorpay_payment_id); â”‚
   â”‚       console.log('Order ID:', response.razorpay_order_id);     â”‚
   â”‚       console.log('Signature:', response.razorpay_signature);  â”‚
   â”‚                                                                  â”‚
   â”‚       // Call verify payment function                           â”‚
   â”‚       await verifyPayment(response.razorpay_order_id);         â”‚
   â”‚     },                                                           â”‚
   â”‚     prefill: {                                                   â”‚
   â”‚       name: userData.name,                                       â”‚
   â”‚       email: userData.email,                                    â”‚
   â”‚       contact: userData.phoneNumber                              â”‚
   â”‚     },                                                           â”‚
   â”‚     theme: {                                                     â”‚
   â”‚       color: "#3399cc"  // Your brand color                     â”‚
   â”‚     },                                                           â”‚
   â”‚     modal: {                                                     â”‚
   â”‚       ondismiss: function() {                                   â”‚
   â”‚         console.log('Payment cancelled by user');               â”‚
   â”‚       }                                                          â”‚
   â”‚     }                                                            â”‚
   â”‚   };                                                             â”‚
   â”‚                                                                  â”‚
   â”‚   const razorpay = new Razorpay(options);                       â”‚
   â”‚   razorpay.open();  // Opens payment popup                      â”‚
   â”‚ }                                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 4: Verify Payment Function
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ async function verifyPayment(orderId, userToken) {               â”‚
   â”‚   try {                                                          â”‚
   â”‚     const response = await fetch(                                â”‚
   â”‚       `/api/dashboard/verifyPayment/${orderId}`,                 â”‚
   â”‚       {                                                          â”‚
   â”‚         headers: {                                               â”‚
   â”‚           'Authorization': `Bearer ${userToken}`,                â”‚
   â”‚           'Content-Type': 'application/json'                    â”‚
   â”‚         }                                                        â”‚
   â”‚       }                                                          â”‚
   â”‚     );                                                           â”‚
   â”‚                                                                  â”‚
   â”‚     const result = await response.json();                        â”‚
   â”‚                                                                  â”‚
   â”‚     if (result.status === 'success') {                          â”‚
   â”‚       // Show success message                                   â”‚
   â”‚       alert('Membership activated successfully!');              â”‚
   â”‚       // Update UI - refresh membership status                  â”‚
   â”‚       // Redirect to membership page or reload                  â”‚
   â”‚       window.location.reload();                                 â”‚
   â”‚     } else {                                                     â”‚
   â”‚       alert('Payment verification failed: ' + result.err);    â”‚
   â”‚     }                                                            â”‚
   â”‚   } catch (error) {                                             â”‚
   â”‚     console.error('Verification error:', error);               â”‚
   â”‚     alert('Error verifying payment. Please contact support.');  â”‚
   â”‚   }                                                              â”‚
   â”‚ }                                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 5: Complete Purchase Flow (Main Function)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ async function purchaseMembership(membershipId, userToken, userData) {â”‚
   â”‚   try {                                                          â”‚
   â”‚     // Show loading state                                       â”‚
   â”‚     setLoading(true);                                            â”‚
   â”‚                                                                  â”‚
   â”‚     // Step 1: Create order                                     â”‚
   â”‚     const orderData = await createPaymentOrder(membershipId, userToken);â”‚
   â”‚                                                                  â”‚
   â”‚     // Step 2: Open Razorpay checkout                          â”‚
   â”‚     openRazorpayCheckout(orderData, userData);                  â”‚
   â”‚                                                                  â”‚
   â”‚     // Note: verifyPayment will be called automatically         â”‚
   â”‚     // in the handler function when payment succeeds            â”‚
   â”‚                                                                  â”‚
   â”‚   } catch (error) {                                             â”‚
   â”‚     console.error('Purchase error:', error);                   â”‚
   â”‚     alert('Failed to initiate payment. Please try again.');     â”‚
   â”‚   } finally {                                                    â”‚
   â”‚     setLoading(false);                                           â”‚
   â”‚   }                                                              â”‚
   â”‚ }                                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 6: Use in Your Component
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ // React Example                                                 â”‚
   â”‚ function MembershipCard({ membership, userToken, userData }) {   â”‚
   â”‚   const [loading, setLoading] = useState(false);                â”‚
   â”‚                                                                  â”‚
   â”‚   const handlePurchase = async () => {                          â”‚
   â”‚     await purchaseMembership(                                    â”‚
   â”‚       membership._id,                                            â”‚
   â”‚       userToken,                                                  â”‚
   â”‚       userData                                                    â”‚
   â”‚     );                                                           â”‚
   â”‚   };                                                             â”‚
   â”‚                                                                  â”‚
   â”‚   return (                                                       â”‚
   â”‚     <button onClick={handlePurchase} disabled={loading}>        â”‚
   â”‚       {loading ? 'Processing...' : 'Buy Membership'}            â”‚
   â”‚     </button>                                                    â”‚
   â”‚   );                                                             â”‚
   â”‚ }                                                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ KEY POINTS FOR WEB INTEGRATION

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         IMPORTANT NOTES                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. RAZORPAY SCRIPT
   âœ… Must include: <script src="https://checkout.razorpay.com/v1/checkout.js">
   âœ… Load before using Razorpay class

2. ORDER CREATION
   âœ… Call backend API: GET /api/dashboard/buyMembership/:id
   âœ… Pass Authorization header with JWT token
   âœ… Get back: orderId, keyId, amount, currency

3. RAZORPAY CHECKOUT
   âœ… Use orderId from backend (NOT your own order ID)
   âœ… Use keyId from backend (NOT hardcoded)
   âœ… Amount is already in paise from backend
   âœ… handler function runs when payment succeeds

4. PAYMENT VERIFICATION
   âœ… Always verify on backend (never trust frontend)
   âœ… Use razorpay_order_id from handler response
   âœ… Call: GET /api/dashboard/verifyPayment/:orderId
   âœ… Update UI only after successful verification

5. ERROR HANDLING
   âœ… Handle network errors
   âœ… Handle payment cancellation
   âœ… Handle verification failures
   âœ… Show user-friendly error messages

6. SECURITY
   âŒ NEVER expose RAZORPAY_KEY_SECRET in frontend
   âœ… Always use keyId from backend
   âœ… Always verify payments on backend
   âœ… Use HTTPS in production
```

---

## ğŸ“± WHAT YOU NEED TO DO IN MOBILE APP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           MOBILE APP IMPLEMENTATION CHECKLIST                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 1: Install Razorpay SDK
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ # React Native                                                   â”‚
   â”‚ npm install react-native-razorpay                                â”‚
   â”‚ cd ios && pod install  # For iOS                                 â”‚
   â”‚                                                                  â”‚
   â”‚ # Flutter                                                        â”‚
   â”‚ Add to pubspec.yaml:                                             â”‚
   â”‚   razorpay_flutter: ^1.3.0                                       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 2: Create Order Function (Same as Web)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ const createOrder = async (membershipId, token) => {            â”‚
   â”‚   const response = await fetch(                                 â”‚
   â”‚     `${API_BASE_URL}/api/dashboard/buyMembership/${membershipId}`,â”‚
   â”‚     {                                                            â”‚
   â”‚       headers: {                                                 â”‚
   â”‚         'Authorization': `Bearer ${token}`,                      â”‚
   â”‚         'Content-Type': 'application/json'                     â”‚
   â”‚       }                                                          â”‚
   â”‚     }                                                            â”‚
   â”‚   );                                                             â”‚
   â”‚   return await response.json();                                 â”‚
   â”‚ };                                                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 3: Open Razorpay Checkout (React Native)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ import RazorpayCheckout from 'react-native-razorpay';           â”‚
   â”‚                                                                  â”‚
   â”‚ const openRazorpay = async (orderData, userData) => {          â”‚
   â”‚   try {                                                          â”‚
   â”‚     const options = {                                            â”‚
   â”‚       description: 'Membership Purchase',                        â”‚
   â”‚       image: 'https://your-logo-url.com/logo.png',               â”‚
   â”‚       currency: orderData.currency,                              â”‚
   â”‚       key: orderData.keyId,                                      â”‚
   â”‚       amount: orderData.amount.toString(), // Must be string!   â”‚
   â”‚       name: 'Connecting Hearts',                                 â”‚
   â”‚       order_id: orderData.orderId,                             â”‚
   â”‚       prefill: {                                                â”‚
   â”‚         email: userData.email,                                  â”‚
   â”‚         contact: userData.phoneNumber,                          â”‚
   â”‚         name: userData.name                                      â”‚
   â”‚       },                                                         â”‚
   â”‚       theme: { color: '#3399cc' }                               â”‚
   â”‚     };                                                           â”‚
   â”‚                                                                  â”‚
   â”‚     const razorpayResponse = await RazorpayCheckout.open(options);â”‚
   â”‚     // Payment successful - verify now                          â”‚
   â”‚     await verifyPayment(razorpayResponse.razorpay_order_id);     â”‚
   â”‚   } catch (error) {                                             â”‚
   â”‚     if (error.code !== 'RazorpayCheckout') {                    â”‚
   â”‚       // User cancelled                                          â”‚
   â”‚       Alert.alert('Cancelled', 'Payment was cancelled');         â”‚
   â”‚     } else {                                                     â”‚
   â”‚       Alert.alert('Error', error.description);                  â”‚
   â”‚     }                                                            â”‚
   â”‚   }                                                              â”‚
   â”‚ };                                                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âœ… STEP 4: Verify Payment (Same as Web)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ const verifyPayment = async (orderId, token) => {               â”‚
   â”‚   try {                                                          â”‚
   â”‚     const response = await fetch(                                â”‚
   â”‚       `${API_BASE_URL}/api/dashboard/verifyPayment/${orderId}`,  â”‚
   â”‚       {                                                          â”‚
   â”‚         headers: {                                               â”‚
   â”‚           'Authorization': `Bearer ${token}`,                     â”‚
   â”‚           'Content-Type': 'application/json'                    â”‚
   â”‚         }                                                        â”‚
   â”‚       }                                                          â”‚
   â”‚     );                                                           â”‚
   â”‚                                                                  â”‚
   â”‚     const result = await response.json();                        â”‚
   â”‚                                                                  â”‚
   â”‚     if (result.status === 'success') {                          â”‚
   â”‚       Alert.alert('Success', 'Membership activated!');         â”‚
   â”‚       // Refresh membership status                             â”‚
   â”‚     } else {                                                     â”‚
   â”‚       Alert.alert('Error', result.err);                        â”‚
   â”‚     }                                                            â”‚
   â”‚   } catch (error) {                                             â”‚
   â”‚     Alert.alert('Error', 'Failed to verify payment');          â”‚
   â”‚   }                                                              â”‚
   â”‚ };                                                               â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ COMPLETE FLOW SUMMARY

```
USER ACTION
    â”‚
    â–¼
[1] User clicks "Buy Membership"
    â”‚
    â–¼
[2] Frontend calls: GET /api/dashboard/buyMembership/:id
    â”‚
    â–¼
[3] Backend creates Razorpay order
    â”‚
    â–¼
[4] Backend returns: { orderId, keyId, amount, currency }
    â”‚
    â–¼
[5] Frontend opens Razorpay Checkout
    â”‚   (Web: Popup | Mobile: Native screen)
    â”‚
    â–¼
[6] User enters payment details & pays
    â”‚
    â–¼
[7] Razorpay processes payment
    â”‚
    â–¼
[8] Payment success â†’ handler function called
    â”‚
    â–¼
[9] Frontend calls: GET /api/dashboard/verifyPayment/:orderId
    â”‚
    â–¼
[10] Backend verifies with Razorpay
    â”‚
    â–¼
[11] Backend activates membership
    â”‚
    â–¼
[12] Frontend shows success & updates UI
```

---

This diagram shows the complete flow. Follow the steps in the "WHAT YOU NEED TO DO" sections to implement in your web and mobile apps.


